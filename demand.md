## Maa-CIYUANJI 项目需求

使用MaaFramework + PySide6实现次元姬小说app签到，及小说内容识别保存到本地。
项目使用conda虚拟环境开发，环境名为Maa-WJDR。（Maa-WJDR环境已经创建，直接使用即可）

代码实现可以参考[maa-wjdr-master](maa-wjdr-master)的源码，该项目也使用的MaaFramework + PySide6架构

###### 1.合理划分模板和文件，合理完成注释信息；

应该避免一个文件过多代码，合理划分模块。
项目中所有与时间相关，统一使用yyyy-MM-dd HH:mm:ss格式显示，日志文件除外。

###### 2.页面布局应该简洁美观

ui布局应该与签到、识别等逻辑分离。

- 主页：
    - 主页上部分显示已连接的设备列表，用户可以在此部分连接设备（以弹窗的方式显示设备列表，支持双击连接、一键连接全部设备等操作）、断开设备。（设备列表展示列："设备名称", "连接地址", "
      ADB路径", "
      状态", "上次签到时间", "操作"）
    - 主页下部分展示所有设备的日志信息，支持显示所有设备日志和单个设备的日志信息。
- 小说：
    - 小说上部分显示小说列表，用户可以在在此处添加（添加通过弹窗的方式）、删除、停用小说。点击开始识别时，进入小说tab页并开始识别（小说列表展示列：名称、当前识别进度、上次识别时间、操作列（开始识别、停用等））。
    - 小说下部分显示正在识别的小说信息，及进度等信息。
- 余额：
    - 上左部分显示所有设备代币总余额；
    - 上右部分显示每个设备列表及代币总余额、距离最近的过期时间；
    - 下部分显示代币的使用记录，点击对应设备时，可只显示该设备的记录信息。

###### 3.连接设备

通过maa获取到的设备信息有设备名称、连接地址、ADB路径，其中连接地址作为设备唯一标识；

###### 4.日志记录

将整体日志信息记录到app.log文件中，每个设备也需要单独记录，以连接地址作为设备日志文件夹，在文件夹下记录具体设备的日志信息。

日志文件需要实现0点自动轮转。

###### 5.使用main类作为主程序入口；

该项目使用 [MaaFramework](https://github.com/MaaXYZ/MaaFramework) 自动化黑盒测试框架的方案三：全代码开发进行项目开发。

ui使用 PySide6进行开发。

###### 6.通过json保持配置和程序运行状态信息 config保存用户配置，如目标小说、目标小说的起始章节、目标小说的结束章节等；

- 配置文件保存在config.json中，包含目标小说、目标小说的起始章节、目标小说的结束章节等信息。
- 运行状态信息保存在stats.json中，包含代币数量以及每个代币的有效期、每个小说识别的进度等信息。

###### 7.代币的相关（代币又名临时书币，命名时避免使用token命名）

- 代币命名以Coin代替
- 代币有三个属性值，代币数量、代币的过期时间、代币的余额。
- 每个模拟器每天都可以签到一次。
- 小说app签到获取到的代币有效期是7天，所以每天获取的代币失效时间都不相同。
  如：第1天签到获取5代币，过期时间为七天后，也就是第8天凌晨；第2天签到获取6代币，过期时间为七天后，也就是第9天凌晨。
- 在使用代币购买付费章节时，应先扣除距离过期时间最短的代币，再使用剩余的代币进行购买。
  如：
  假如当前共有19代币，分别为，8代币过期时间为2025-10-18 00:00:00、11代币过期时间为2025-10-19 00:00:00。
  购买付费章节时所需12代币，则先扣除8代币，余4代币则扣除11代币余额。
  最后剩余代币为7代币过期时间为2025-10-18 00:00:00（即，总额11代币的余额为7代币）。

###### 8.已爬取的章节先用json保存，每个章节以章节名保存为一个json，其中包含章节信息，对应设备等；

- 小说名为文件夹，以章节名为文件名。
- 支持一键导出，将目标小说所有章节json的章节内容提取并合并为一个txt文件。

###### 9.支持一个小说通过多个设备来识别小说内容，每个设备之间不识别重复的章节。

一个小说通过多个**设备异步识别**小说内容，每个设备之间不识别重复的章节（**多个设备间应避免重复购买和识别同一章节**）。
如第1章在a设备上识别后，在其他设备上将不在重复购买和识别第1章。



