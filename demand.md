## Maa-CIYUANJI 项目需求

使用MaaFramework + PySide6实现次元姬小说app签到，及小说内容识别保存到本地。
项目使用conda虚拟环境开发，环境名为Maa-WJDR。（Maa-WJDR环境已经创建，直接使用即可）

###### 1.合理划分模板和文件，合理完成注释信息；

应该避免一个文件过多代码，合理划分模块。
项目中所有与时间相关，统一使用yyyy-MM-dd HH:mm:ss格式显示，日志文件除外。

###### 2.页面布局应该简洁美观

ui布局应该与签到、识别等逻辑分离。

###### 3.使用main类作为主程序入口；

该项目使用 MaaFramework 自动化黑盒测试框架的方案三：全代码开发进行项目开发。
ui使用 PySide6进行开发。

###### 4.通过json保持配置和程序运行状态信息 config保存用户配置，如目标小说、目标小说的起始章节、目标小说的结束章节等；

- 配置文件保存在config.json中，包含目标小说、目标小说的起始章节、目标小说的结束章节等信息。
- 运行状态信息保存在stats.json中，包含代币数量以及每个代币的有效期、每个小说识别的进度等信息。

###### 5.代币的相关（代币又名临时书币，命名时避免使用token命名）

- 代币有三个属性值，代币数量、代币的过期时间、代币的余额。
- 每个模拟器每天都可以签到一次。
- 小说app签到获取到的代币有效期是7天，所以每天获取的代币失效时间都不相同。
  如：第1天签到获取5代币，过期时间为七天后，也就是第8天凌晨；第2天签到获取6代币，过期时间为七天后，也就是第9天凌晨。
- 在使用代币购买付费章节时，应先扣除距离过期时间最短的代币，再使用剩余的代币进行购买。
  如：
  假如当前共有19代币，分别为，8代币过期时间为2025-10-18 00:00:00、11代币过期时间为2025-10-19 00:00:00。
  购买付费章节时所需12代币，则先扣除8代币，余4代币则扣除11代币余额。
  最后剩余代币为7代币过期时间为2025-10-18 00:00:00（即，总额11代币的余额为7代币）。

###### 6.已爬取的章节先用json保存，每个章节以章节名保存为一个json，其中包含章节信息，对应设备等；

- 小说名为文件夹，以章节名为文件名。

###### 7.支持一键导出，将目标小说所有章节json的章节内容提取并合并为一个txt文件。

###### 8.支持一个小说通过多个设备来识别小说内容，每个设备之间不识别重复的章节。

一个小说通过多个设备异步识别小说内容，每个设备之间不识别重复的章节。
如第1章在a设备上识别后，在其他设备上将不在重复购买和识别第1章。


---
补充需求 - 2025年10月16日 11点30分
重构页面布局，tab页分为主页、小说、余额。

- 主页：
    - 主页上部分显示小说列表，用户可以在在此处添加（添加通过弹窗的方式）、删除、停用小说。点击开始识别时，进入小说tab页并开始识别。
    - 主页下部分显示已连接的设备列表，用户可以在此部分连接设备（弹窗方式显示设备列表，支持双击连接、一键连接全部设）、断开设备。
- 小说：
    - 上部分显示正在识别的小说信息，及进度
    - 下部分显示识别日志信息
- 余额：
    - 分别显示所有设备代币总余额、每个设备代币总余额、距离最近的过期时间
    - 显示代币的使用记录

--- 
补充需求 - 2025年10月16日 11点40分
缺少日志输出和日志文件
--- 

补充需求 - 2025年10月16日 11点50分
通过maa获取到的设备信息有设备名称、连接地址、ADB路径，其中连接地址作为设备唯一标识；另外添加状态列，用来标识设备是否连接成功。

--- 
补充需求 - 2025年10月16日 11点53分
主页的设备列表只显示已经连接的设备。删除主页的检测设备按钮
连接设备弹窗的设备列表应该使用列表显示

--- 
补充需求 - 2025年10月16日 12点20分
连接设备弹窗的设备列表应该使用列表，与主页设备列表一致，但显示所有检测到的设备。不需要QGroupBox("设备详细信息")

--- 
补充需求 - 2025年10月16日 12点23分
小说列表也通过table显示，添加列：名称、当前识别进度、上次识别时间、操作列（开始识别、停用等）。
另外优化选行的显示、设置当前tab的标题加粗显示

--- 
补充需求 - 2025年10月16日 12点23分
优化连接设备弹窗中列表选行的显示

--- 
补充需求 - 2025年10月16日 12点42分

main_ui.py文件代码过多，不利与查看，根据tab页拆分成多个文件